<?xml version="1.0" encoding="UTF-8"?>
<site site="http://mlb.mlb.com"
    plugin="http://mlb.mlb.com/flash/mediaplayer/v4.2/R2/MediaPlayer4.swf"
    identifier="com.plexapp.plugins.harleyball"
    initialState="loading"
    version="0.3-beta">

    <crop x="0" y="102" width="800" height="450" />

    <!-- halt -->
    <state name="halt"/>

    <!-- loading -->
    <state name="loading">
        <event>
            <condition>
                <and>
                    <frameLoaded />
                    
                </and>
            </condition>
            <action>
                <pause time="5000"/>
                <click x="396" y="510"/>
                <goto state="login"/>
            </action>
        </event>
    </state>

    <!-- playing -->
    <state name="playing">
        <!-- showing the login form -->




        <!-- message: hd alert -->
        <event>
            <condition>
                <and>
                    <color x="368" y="404" rgb="ffffff"/>
                    <color x="375" y="404" rgb="ffffff"/>
                    <color x="372" y="407" rgb="ffffff"/>
                    <color x="368" y="411" rgb="ffffff"/>
                    <color x="375" y="411" rgb="ffffff"/>
                </and>
            </condition>
            <action>
                <click x="372" y="407"/>
                <goto state="playing"/>
            </action>
        </event>

        <!-- pause button -->
        <event>
            <condition>
                <command name="pause"/>
            </condition>
            <action>
                <move x="396" y="510"/>
                <pause time="500"/>
                <click x="396" y="510"/>
                <move x="0" y="0"/>
                <goto state="paused"/>
            </action>
        </event>
    </state>

    <!-- paused -->
    <state name="paused">
        <!-- play button -->
        <event>
            <condition>
                <command name="play"/>
            </condition>
            <action>
                <move x="396" y="510"/>
                <pause time="500"/>
                <click x="396" y="510"/>
                <move x="0" y="0"/>

                <goto state="playing"/>
            </action>
        </event>
    </state>

    <!-- login prompt -->
    <state name="login">
        <event>
            <condition>
                <and>
                    
                    <pref name="mlb_user" exists="true"/>
                    <pref name="mlb_pass" exists="true"/>
                </and>
            </condition>
            <action>
                <!-- set focus -->


                <!-- "double click" the email input to select all -->
				<run script="function logMeIn(){document.getElementById('emailAddress').value='${mlb_user}';document.getElementById('password').value='${mlb_pass}';document.getElementById('login').submit();}"/>
                <run script="logMeIn();"/>
				<pause time="1000" />
				<visit url="https://secure.mlb.com/account/profile.jsp?flowId=registration.ajax.wizard&amp;c_id=mlb_1" />

                <!-- wait for the form to animate closed -->
                <pause time="2000"/>

                <goto state="login-check"/>
            </action>
        </event>
    </state>

    <state name="login-check">
		<event>
			<condition>
                <frameLoaded/>
				<javascript script="login = $('#pageloading').length == 1 ? 1 : 0" matches="0" />
            </condition>
			<action>
				<visit url="${url}" />
				<goto state="playing" />
			</action>
		</event>
        <event>
            <condition>
                <frameLoaded/>
                <javascript script="login = $('#pageloading').length == 1 ? 1 : 0" matches="1" />
            </condition>
			<action>
				<goto state="end" param="Please check your username and password in the plugin's settings" />
			</action>
		</event>

	</state>


  


</site>
